<%- include('include/head.ejs') %> 
<%- include('include/titleBar.ejs') %> 
<%-include('include/sideNavBar.ejs') %> 

<% let loginParticipante = ''; %>
<% for (grupo of grupos) { %>
  <div class="row">
    <div class="col s12 m6 ">
      <h5>Terapeuta: <%= grupo.nombreUsuario%> <%= grupo.apellidoPaterno%></h5>
    </div>
    <div class="col s12 m6">
    </div>
  </div>
  <div class="row">
    <div class="col s12 m4 l4 ">
      <table >
        <thead>
          <tr>
            <th>Participantes</th>
            <th>Nivel</th>
            <th>Calificaciones</th>
          </tr>
        </thead>
        </tbody>
        <% for (participante of participantes) { %>
          <% if (participante.login !== loginParticipante && participante.idGrupo === grupo.idGrupo) { %>
            <tr>
              <td>
                <a  onclick="registroPuntajes(<%=grupo.idGrupo%>,'<%=participante.login%>')" href="#rPuntaje-<%=participante.login%>">
                  <%=participante.nombreUsuario%>  <%=participante.apellidoPaterno%>    <%=participante.apellidoMaterno%>  
                 </a>
              </td>
              <td>  <%=participante.nombreNivel%>  </td>
              <td></td>
            
          
              <% loginParticipante = participante.login;%>
            <% } %>
          <% } %>
        </tbody>
      </table>
      <br /><br />
    </div>
    <div class="col s12 m8 l8 asignar-puntaje">
      <div id="objetivos-participante-grupo-<%=grupo.idGrupo%>">

      </div>
    </div>
  </div>

<% } %>
  

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems);
  });
  const registroPuntajes = (idGrupo, login) => {
    let data = {
      grupo_id: idGrupo,
      login_participante: login
    };
    console.log(data);
    //función que manda la petición asíncrona
    fetch('/programas/registro-puntaje', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
            //'csrf-token': csrf
        },
        body: JSON.stringify(data)
    }).then(result => {
        return result.json(); //Regresa otra promesa
    }).then(data => {
      //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
      //...
      let html = '';

      html ='<h6>Asignar puntajes a: ' + data.objetivos[0].nombreUsuario + ' ' + data.objetivos[0].apellidoPaterno + '</h6>' +
              '<table>' +
                '<thead>' +
                  '<th>Objetivos</th>' +
                  '<th>Puntaje inicial</th>' +
                  '<th>Puntaje final</th>' +
                '</thead>' +
                '<tbody>';
      for(objetivo of data.objetivos){
        html +=   '<tr>' +
                    '<td>' +
                      objetivo.descripcion +
                    '</td>' +  
                    '<td>' +
                      '<select name = "puntajeInicial">';
          html +=         '<option value="" disabled selected> holaa </option>'
          for(let puntaje = 1; puntaje <= objetivo.puntajeMaximo; puntaje++){
              html +=     '<option value="' + puntaje + '"> ' + puntaje + '</option>';
          }
          html +=       '</select>';
        
          html +=   '</td>' + 
                    '<td>' +
                      '<select name = "puntajeFinal">';
          html +=       '<option value="" disabled selected> - </option>'
          for(let puntaje = 1; puntaje <= objetivo.puntajeMaximo; puntaje++){
              html +=     '<option value="' + puntaje + '"> ' + puntaje + '</option>';
          }
          html +=       '</select>';
                    '</td>' +
                  '<tr>'
      }
                  
      html +=   '</tbody>' +
              '</table>';

      html +=         '<label>Browser Select</label>' +
  '<select class="browser-default">' +
    '<option value="" disabled selected>Choose your option</option>' +
    '<option value="1">Option 1</option>' +
    '<option value="2">Option 2</option>' +
    '<option value="3">Option 3</option>' + 
  '</select>';
      let id = 'objetivos-participante-grupo-' + data.objetivos[0].idGrupo;
      M.AutoInit();
      document.getElementById(id).innerHTML = html;
     
    }).catch(err => {
      console.log(err);
    });
  };
</script>
<%- include('include/footer.ejs') %>
